<script src="https://unpkg.com/aframe-environment-component@1.2.0/dist/aframe-environment-component.min.js"></script>
<div id="replace" class="row">
  <% records.forEach(function(record){ %>
    <%- include("./partials/environmentCard.ejs",{record:record}) %>
      <% }) %>
</div>
<div class="row">
  <!-- Modal Trigger -->
  <div class="card-action">
    <a id="" class="waves-effect waves-light btn create_env modal-trigger" href="#modal1">Create Environment</a>
  </div>
</div>

<!-- Modal Structure -->
<div id="modal1" class="modal">
  <div class="modal-content">
    <h4>Create Environment</h4>
    <div class="row">
      <div class="col s12 m6">
        <div class="card blue-grey darken-1">
          <div class="card-content white-text">
            <div class="row">
              <div class="input-field col s6">
                <input value="" id="env_name" type="text" class="validate">
                <label for="env_name">Environment Name</label>
              </div>
            </div>
            <div class="row">
              <div class="input-field col s6">
                <input value="" id="env_creator" type="text" class="validate">
                <label for="env_creator">Environment Creator</label>
              </div>
            </div>
            <div class="row">
              <div class="input-field col s6">
                <input value="" id="env_op_pano" type="text" class="validate">
                <label for="env_op_pano">Panoram</label>
              </div>
            </div>
            <div class="row">
              <div class="input-field col s6">
                <input value="" id="env_op_preset" type="text" class="validate">
                <label for="env_op_preset">preset</label>
              </div>
            </div>
            <div class="row">
              <div class="input-field col s6">
                <input value="" id="env_op_video" type="text" class="validate">
                <label for="env_op_video">video</label>
              </div>
            </div>
            <div class="row">
              <div class="input-field col s6">
                <input value="" id="env_op_floor_color" type="text" class="validate">
                <label for="env_op_floor_color">floor color</label>
              </div>
            </div>
            <div class="row">
              <div class="input-field col s6">
                <input value="" id="env_op_floor_url" type="text" class="validate">
                <label for="env_op_floor_url">floor url</label>
              </div>
            </div>
            <div class="row">
              <div class="input-field col s6">
                <input value="" id="env_op_sky_color" type="text" class="validate">
                <label for="env_op_sky_color">sky color</label>
              </div>
            </div>
            <div class="row">
              <div class="input-field col s6">
                <input value="" id="env_op_sky_url" type="text" class="validate">
                <label for="env_op_sky_url">sky url</label>
              </div>
            </div>
            
            <p>I am a very simple card. I am good at containing small bits of information.
              I am convenient because I require little markup to use effectively.</p>
          </div>
        </div>
      </div>
    </div>
  </div>
  <div class="modal-footer">
    <div class="card-action">
      <a id="" class="waves-effect waves-light btn upload_env">Create Environment</a>
    </div>
  </div>
</div>
</div>
<script>
  $(document).on('click', '.waves-effect.waves-light.btn.edit', function (e) {
    e.preventDefault();
    let id = $(this).attr('id');
    window.location.href = "/api/editEnvironment/" + id;
  });
  // Create Environment 
  $(document).on('click', '.waves-effect.waves-light.btn.upload_env', function (e) {
    e.preventDefault();
    
    let env_name = $('#env_name').val();
    let env_creator = $('#env_creator').val();
    let env_op_pano = $('#env_op_pano').val();
    let env_op_preset = $('#env_op_preset').val();
    let env_op_video = $('#env_op_video').val();
    let env_op_floor_color = $('#env_op_floor_color').val();
    let env_op_floor_url = $('#env_op_floor_url').val();
    let env_op_sky_color = $('#env_op_sky_color').val();
    let env_op_sky_url = $('#env_op_sky_url').val();

    console.log(env_name);
    let skyAsset ={
      color:env_op_sky_color,
      url:env_op_sky_url
    }
    let floorAsset ={
      color:env_op_floor_color,
      url:env_op_floor_url
    }
    let vrObject={};

    let environmentOptions ={
      panorama:env_op_pano,
      preset:env_op_preset,
      video:env_op_video,
      floorAsset:floorAsset,
      skyAsset:skyAsset

    }

    data ={
      environmentName:env_name,
      environmentCreator:env_creator,
      environmentOptions:environmentOptions,
      vrObject:vrObject
    }
    $.ajax({
      type: 'POST',
      url: '/api',
      data: data,
      success: (res)=>{
          console.log(res)
          location.reload();
      },
      dataType: 'json',
    });
  });
  document.addEventListener('DOMContentLoaded', function () {
    var elems = document.querySelectorAll('.modal');
    var instances = M.Modal.init(elems);
  });

  $(document).on('click','.waves-effect.waves-light.btn.delete',function(){
    let id =  $(this).attr('id');
    let data ={id}
    console.log(id)
    $.ajax({
      type: 'DELETE',
      url: '/api/deleteEnvironment',
      data: data,
      success: (res)=>{
          console.log(res)
          location.reload();
      },
      dataType: 'json',
    });
  })
</script>