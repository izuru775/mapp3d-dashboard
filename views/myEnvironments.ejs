<script src="https://unpkg.com/aframe-environment-component@1.2.0/dist/aframe-environment-component.min.js"></script>
<div id="replace" class="row">
  <% records.forEach(function(record){ %>
    <%- include("./partials/environmentCard.ejs",{record:record}) %>
      <% }) %>
</div>
<div class="row">
  <!-- Modal Trigger -->
  <div class="card-action">
    <a id="" class="waves-effect waves-light btn create_env modal-trigger" href="#modal1">Create Environment</a>
  </div>
</div>

<!-- Modal Structure -->
<div id="modal1" class="modal">
  <div class="modal-content">
    <h4>Create Environment</h4>
    <div class="row" style="min-width: 100%;">
      <div class="col s12 m6" >
        <div class="card blue-grey darken-1" >
          <div class="card-content white-text">
            <div class="row">
              <div class="input-field col s6">
                <input value="" id="env_name" type="text" class="validate">
                <label for="env_name">Environment Name</label>
              </div>
            </div>
            <div class="row">
              <div class="input-field col s6">
                <input value="" id="env_creator" type="text" class="validate">
                <label for="env_creator">Environment Creator</label>
              </div>
            </div>
            <div class="row">
              <div class="input-field col s6">
                <input value="" id="env_op_pano" type="text" class="validate">
                <label for="env_op_pano">Panoram</label>
              </div>
            </div>
            <div class="row">
              <div class="input-field col s6">
                <input value="" id="env_op_preset" type="text" class="validate">
                <label for="env_op_preset">preset</label>
              </div>
            </div>
            <div class="row">
              <!-- Select objects -->
              <label>Select a preset</label>
              <select id="preset_select" class="preset browser-default ">
                <option value="" disabled selected>
                  Choose your option
                </option>
                <option value="none">none</option>
                <option value="default">default</option>
                <option value="contact">contact</option>
                <option value="egypt">egypt</option>
                <option value="checkerboard">checkerboard</option>
                <option value="forest">Forest</option>
                <option value="goaland">goaland</option>
                <option value="yavapai">yavapai</option>
                <option value="goldmine">goldmine</option>
                <option value="threetowers">threetowers</option>
                <option value="poison">poison</option>
                <option value="arches">arches</option>
                <option value="tron">tron</option>
                <option value="japan">japan</option>
                <option value="dream">dream</option>
                <option value="volcano">volcano</option>
                <option value="osiris">starry</option>
                <option value="forest">osiris</option>
                <option value="moon">moon</option>
                
              </select>
            </div>
            <div class="row">
              <div class="input-field col s6">
                <input value="" id="env_op_video" type="text" class="validate">
                <label for="env_op_video">video</label>
              </div>
            </div>
            <div class="row">
              <select class="browser-default update">
                <option value="" disabled selected>
                  Choose Video
                </option>
              </select>
            </div>
            <div class="row">
              <div class="input-field col s6">
                <input value="" id="env_op_floor_color" type="text" class="validate">
                <label for="env_op_floor_color">floor color</label>
              </div>
            </div>
            <div class="row">
              <div class="input-field col s6">
                <input value="" id="env_op_floor_url" type="text" class="validate">
                <label for="env_op_floor_url">floor url</label>
              </div>
            </div>
            <div class="row">
              <div class="input-field col s6">
                <input value="" id="env_op_sky_color" type="text" class="validate">
                <label for="env_op_sky_color">sky color</label>
              </div>
            </div>
            <div class="row">
              <div class="input-field col s6">
                <input value="" id="env_op_sky_url" type="text" class="validate">
                <label for="env_op_sky_url">sky url</label>
              </div>
            </div>
            
            
          </div>
        </div>
      </div>
    </div>
  </div>
  <div class="modal-footer">
    <div class="card-action">
      <a id="" class="waves-effect waves-light btn upload_env">Create Environment</a>
    </div>
  </div>
</div>
</div>
<script>
  $(document).on('click', '.waves-effect.waves-light.btn.edit', function (e) {
    e.preventDefault();
    let id = $(this).attr('id');
    window.location.href = "/api/editEnvironment/" + id;
  });
  // Create Environment 
  $(document).on('click', '.waves-effect.waves-light.btn.upload_env', function (e) {
    e.preventDefault();
    
    let env_name = $('#env_name').val();
    let env_creator = $('#env_creator').val();
    let env_op_pano = $('#env_op_pano').val();
    let env_op_preset = $('#env_op_preset').val();
    let env_op_video = $('#env_op_video').val();
    let env_op_floor_color = $('#env_op_floor_color').val();
    let env_op_floor_url = $('#env_op_floor_url').val();
    let env_op_sky_color = $('#env_op_sky_color').val();
    let env_op_sky_url = $('#env_op_sky_url').val();

    console.log(env_name);
    let skyAsset ={
      color:env_op_sky_color,
      url:env_op_sky_url
    }
    let floorAsset ={
      color:env_op_floor_color,
      url:env_op_floor_url
    }
    let vrObject={};

    let environmentOptions ={
      panorama:env_op_pano,
      preset:env_op_preset,
      video:env_op_video,
      floorAsset:floorAsset,
      skyAsset:skyAsset

    }

    data ={
      environmentName:env_name,
      environmentCreator:env_creator,
      environmentOptions:environmentOptions,
      vrObject:vrObject
    }
    $.ajax({
      type: 'POST',
      url: '/api',
      data: data,
      success: (res)=>{
          console.log(res)
          location.reload();
      },
      dataType: 'json',
    });
  });
  document.addEventListener('DOMContentLoaded', function () {
    var elems = document.querySelectorAll('.modal');
    var instances = M.Modal.init(elems);
  });

  $(document).on('click','.waves-effect.waves-light.btn.delete',function(){
    let id =  $(this).attr('id');
    let data ={id}
    console.log(id)
    $.ajax({
      type: 'DELETE',
      url: '/api/deleteEnvironment',
      data: data,
      success: (res)=>{
          console.log(res)
          location.reload();
      },
      dataType: 'json',
    });
  })

  $(document).ready(function () {
    getObjects();
  });

  const getObjects =()=>{
    $.ajax({
      url: "/aws/obj/list/",
      type: 'GET',
      dataType: 'json', // added data type
      success: function (res) {
        res.objects.forEach(element => {
          console.log(element.filename)
          $('.browser-default',).append(`<option value="${element.url}">${element.filename}</option>`)
        });

      }
    });
  }

  $(document).on('change', '.browser-default.update', function () {
    $('#env_op_video').attr('value', this.value)
  })

  $(document).on('change', '#preset_select', function () {
    $('#env_op_preset').attr('value', this.value)

  })
</script>